<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Client - Light 4J - A fast, lightweight Java microservices framework</title>
    <meta name="generator" content="Hugo 0.20.6" />

    
    <meta name="description" content="Light 4J Docs">
    
    <link rel="canonical" href="https://networknt.github.io/light-4j/other/client/">
    
    <meta name="author" content="Steve Hu">
    

    <meta property="og:url" content="https://networknt.github.io/light-4j/other/client/">
    <meta property="og:title" content="Light 4J - A fast, lightweight Java microservices framework">
    <meta property="og:image" content="https://networknt.github.io/light-4j/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Light 4J - A fast, lightweight Java microservices framework">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://networknt.github.io/light-4j/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://networknt.github.io/light-4j/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://networknt.github.io/light-4j/fonts/icon.eot');
        src: url('https://networknt.github.io/light-4j/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://networknt.github.io/light-4j/fonts/icon.woff')
               format('woff'),
             url('https://networknt.github.io/light-4j/fonts/icon.ttf')
               format('truetype'),
             url('https://networknt.github.io/light-4j/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://networknt.github.io/light-4j/stylesheets/application.css">
    <link rel="stylesheet" href="https://networknt.github.io/light-4j/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://networknt.github.io/light-4j/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://networknt.github.io/light-4j/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://networknt.github.io/light-4j/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-red palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Client
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/stevehu" title="@stevehu on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/networknt/light-4j" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://networknt.github.io/light-4j/images/logo.png">
        </div>
      
      <div class="name">
        <strong>Light 4J - A fast, lightweight Java microservices framework <span class="version">1.4.1</span></strong>
        
          <br>
          networknt/light-4j
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/networknt/light-4j/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/networknt/light-4j/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Getting started" href="https://networknt.github.io/light-4j/getting-started/">
	
	Getting started
</a>



  
</li>



<li>
  
    



<a  title="Architecture" href="https://networknt.github.io/light-4j/architecture/">
	
	Architecture
</a>



  
</li>



<li>
  
    



<a  title="Design" href="https://networknt.github.io/light-4j/design/">
	
	Design
</a>



  
</li>



<li>
  
    



<a  title="Middleware" href="https://networknt.github.io/light-4j/middleware/">
	
	Middleware
</a>



  
</li>



<li>
  
    



<a  title="Other Components" href="https://networknt.github.io/light-4j/other/">
	
	Other Components
</a>



  
</li>



<li>
  
    



<a  title="DevOps" href="https://networknt.github.io/light-4j/devops/">
	
	DevOps
</a>



  
</li>



<li>
  
    



<a  title="Benchmarks" href="https://networknt.github.io/light-4j/benchmarks/">
	
	Benchmarks
</a>



  
</li>



<li>
  
    



<a  title="Tutorials" href="https://networknt.github.io/light-4j/tutorials/">
	
	Tutorials
</a>



  
</li>



<li>
  
    



<a  title="Examples" href="https://networknt.github.io/light-4j/example/">
	
	Examples
</a>



  
</li>



<li>
  
    



<a  title="Tools" href="https://networknt.github.io/light-4j/tools/">
	
	Tools
</a>



  
</li>



<li>
  
    



<a  title="Issues &amp; Help" href="https://github.com/networknt/light-4j/issues">
	
	Issues &amp; Help
</a>



  
</li>



<li>
  
    



<a  title="Roadmap" href="https://networknt.github.io/light-4j/roadmap/">
	
	Roadmap
</a>



  
</li>



<li>
  
    



<a  title="FAQ" href="https://networknt.github.io/light-4j/faq/">
	
	FAQ
</a>



  
</li>



<li>
  
    



<a  title="License" href="https://www.apache.org/licenses/LICENSE-2.0">
	
	License
</a>



  
</li>



<li>
  
    



<a  title="Introduction" href="https://networknt.github.io/light-4j/index.html">
	
	Introduction
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/stevehu" target="_blank" title="@stevehu on GitHub">
              @stevehu on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:stevehu@gmail.com" title="Email of stevehu@gmail.com">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Client </h1>

			

<h2 id="introduction">Introduction</h2>

<p>In microservices architecture, service to service communication can be done by
request/response style or messaging/event style. An efficient http client is
crucial in request/response style as the number of interaction between services
are high and extra latency can kill the entire application peformance to cause
the failuer of microservices application.</p>

<p>In the early day of light-4j we have a client module based on Apache HttpClient
and Apache HttpAsyncClient which supports HTTP 1.1 and is very popular in the
open source community. However, it was designed long ago and it is very hard to
use because too many configurations. It is also very big and slow compare with
other modern http clients. Another big issue is HTTP 2.0 support as light-*-4j
frameworks support HTTP2 natively and we want to take advantage on the client
side as well.</p>

<p>In looking for Java HTTP clients that support HTTP 2.0, I was stuck there as
none of the them support it gracefully. Some are partial support and most of
them require you to put a version of jar file in the command line so work with
Java 8. Everybody seems to waiting for Java 9 to come out but we cannot use it
on production until it is ready.</p>

<p>Given above situations, I decided to implement my own Http2Client based on what
we have in Undertow. I have proposed the idea to implement a generic Http2Client
to Undertow community but it wasn&rsquo;t interested. It will take a long time to build
an independent Http2Client without depending on Undertow and it is OK with us
as our server is based on Undertow. Other people might have a concern on that but
the argument is Undertow core is extremely small and I don&rsquo;t thing it is a big
issue for other people to use it outside of light-*-4j.</p>

<p>I am starting an <a href="https://github.com/networknt/http2client-benchmark">http client benchmark</a>
and if there are more interests on this client, I will make it an independent
module without depending on Undertow so that other people working on other platforms
can use it without extra Undertow core.</p>

<h2 id="usage">Usage</h2>

<p>Http2Client supports both HTTP 1.1 and HTTP 2.0 transparently depending on the
server HTTP 2.0 support and is used to call APIs from the following sources:</p>

<ol>
<li>Web Server</li>
<li>Standalone Application/Mobile Application</li>
<li>API/Service</li>
</ol>

<p>It provides method to get authorization token and automatically gets client
credentials token for scopes in API to API calls. It also helps to pass correlationId
and traceabilityId and other configurable headers to the next service.</p>

<h3 id="generic-response-callback-functions">Generic response callback functions</h3>

<p>Like Undertow core server, it is event driven with callbacks so non-blocking
all the time to free your CPU for other important computation. Http2Client
has two generic callback functions implemented to handle request with body(POST,
PUT, PATCH) and request without body(GET, DELETE). Users can create their own
customized callback functions to handle the response from the server.</p>

<h3 id="client-credentials-token-renew-and-cache">Client Credentials token renew and cache</h3>

<p>The renew of token happens behind the scene and it supports circuit breaker
if OAuth2 server is down or busy. It renews the token pro-actively before the
current one is expired and lets all requests go with the current token. It only
block other request if the current request is trying to renew an expired token.
When token renewal in this case fails, all request will be rejected with timeout
and subsequent requests the same until a grace period is passed so that the
renew process is start again.</p>

<h3 id="examples">Examples</h3>

<h4 id="get-a-client-instance">Get a client instance</h4>

<pre><code>    Http2Client client = Http2Client.getInstance();
</code></pre>

<h4 id="call-from-web-server">Call from web server</h4>

<p>To set the header with authorization code JWT token.</p>

<pre><code>    public void addAuthToken(HttpRequest request, String token) 

</code></pre>

<p>To set the header with authorization code JWT token and traceabilityId.</p>

<pre><code>    public void addAuthTokenTrace(HttpRequest request, String token, String traceabilityId) 
</code></pre>

<h4 id="call-from-standalone-app-mobile-app">Call from standalone app/mobile app</h4>

<p>To set the header with client credentials JWT token.</p>

<pre><code>    public void addCcToken(HttpRequest request) throws ClientException, ApiException 
</code></pre>

<p>To set the header with client credentials JWT token and traceabilityId.</p>

<pre><code>    public void addCcTokenTrace(HttpRequest request, String traceabilityId) throws ClientException, ApiException 

</code></pre>

<h4 id="call-from-api-service">call from API/service</h4>

<p>To pass in exchange.</p>

<pre><code>    public void propagateHeaders(HttpRequest request, final HttpServerExchange exchange) throws ClientException, ApiException 

</code></pre>

<p>To pass in variables individually.</p>

<pre><code>    public void populateHeader(HttpRequest request, String authToken, String correlationId, String traceabilityId) throws ClientException, ApiException 

</code></pre>


			<aside class="copyright" role="note">
				
				&copy; 2017 Released under the MIT license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://networknt.github.io/light-4j/other/config/" title="Config">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Config
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://networknt.github.io/light-4j/middleware/sanitizer/" title="Sanitizer">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Sanitizer
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/networknt.github.io\/light-4j\/';
      var repo_id  = 'networknt\/light-4j';
    
    </script>

    <script src="https://networknt.github.io/light-4j/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

